<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elizabeth's Pregnancy Journey - Enhanced</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <!-- EmailJS for email functionality -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root {
            /* Enhanced Color Palette with Better Contrast */
            --primary-50: #fef7ed;
            --primary-100: #fed7aa;
            --primary-200: #fdba74;
            --primary-300: #fb923c;
            --primary-400: #f97316;
            --primary-500: #ea580c;
            --primary-600: #dc2626;
            --primary-700: #b91c1c;
            --primary-800: #991b1b;
            --primary-900: #7f1d1d;

            --secondary-50: #f0f9ff;
            --secondary-100: #e0f2fe;
            --secondary-200: #bae6fd;
            --secondary-300: #7dd3fc;
            --secondary-400: #38bdf8;
            --secondary-500: #0ea5e9;
            --secondary-600: #0284c7;
            --secondary-700: #0369a1;
            --secondary-800: #075985;
            --secondary-900: #0c4a6e;

            --accent-50: #fdf4ff;
            --accent-100: #fae8ff;
            --accent-200: #f5d0fe;
            --accent-300: #f0abfc;
            --accent-400: #e879f9;
            --accent-500: #d946ef;
            --accent-600: #c026d3;
            --accent-700: #a21caf;
            --accent-800: #86198f;
            --accent-900: #701a75;

            /* High Contrast Neutral Palette */
            --white: #ffffff;
            --gray-50: #fafaf9;
            --gray-100: #f5f5f4;
            --gray-200: #e7e5e4;
            --gray-300: #d6d3d1;
            --gray-400: #a8a29e;
            --gray-500: #78716c;
            --gray-600: #57534e;
            --gray-700: #44403c;
            --gray-800: #292524;
            --gray-900: #1c1917;
            --black: #000000;

            /* Status Colors */
            --success-50: #f0fdf4;
            --success-500: #22c55e;
            --success-600: #16a34a;
            --warning-50: #fffbeb;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            --error-50: #fef2f2;
            --error-500: #ef4444;
            --error-600: #dc2626;

            /* Enhanced Shadows for Better Depth */
            --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --shadow-text: 0 2px 4px rgb(0 0 0 / 0.3);

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
            --radius-3xl: 32px;

            /* Spacing Scale */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-feature-settings: 'cv11', 'ss01';
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 1440px;
            margin: 0 auto;
            padding: var(--space-6);
            position: relative;
        }

        /* Enhanced Floating Background Elements */
        .bg-decoration {
            position: fixed;
            pointer-events: none;
            opacity: 0.08;
            z-index: -1;
        }

        .bg-circle-1 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--primary-400), transparent);
            border-radius: 50%;
            top: 5%;
            left: -5%;
            animation: float 8s ease-in-out infinite;
        }

        .bg-circle-2 {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--accent-400), transparent);
            border-radius: 50%;
            top: 50%;
            right: -5%;
            animation: float 10s ease-in-out infinite reverse;
        }

        .bg-circle-3 {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--secondary-400), transparent);
            border-radius: 50%;
            bottom: 10%;
            left: 10%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1) rotate(0deg); }
            50% { transform: translateY(-30px) scale(1.1) rotate(180deg); }
        }

        /* Header with Better Contrast */
        .header {
            text-align: center;
            margin-bottom: var(--space-12);
            position: relative;
        }

        .app-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 700;
            color: var(--white);
            margin-bottom: var(--space-2);
            letter-spacing: -0.02em;
            text-shadow: var(--shadow-text);
            position: relative;
        }

        .app-subtitle {
            font-size: 1.5rem;
            color: var(--white);
            font-weight: 500;
            margin-bottom: var(--space-2);
            text-shadow: var(--shadow-text);
            opacity: 0;
            animation: fadeInUp 0.8s ease 0.3s forwards;
        }

        .personal-welcome {
            font-size: 1.125rem;
            color: var(--white);
            font-weight: 400;
            margin-bottom: var(--space-8);
            text-shadow: var(--shadow-text);
            opacity: 0.9;
        }

        /* Mode Toggle */
        .mode-toggle {
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .toggle-switch.active {
            background: var(--warning-500);
            border-color: var(--warning-600);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 22px;
            height: 22px;
            background: var(--white);
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }

        .toggle-label {
            color: var(--white);
            font-weight: 600;
            font-size: 0.875rem;
            text-shadow: var(--shadow-text);
        }

        /* Enhanced Header Stats with Better Contrast */
        .header-stats {
            display: flex;
            justify-content: center;
            gap: var(--space-8);
            margin-bottom: var(--space-8);
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            min-width: 200px;
            text-align: center;
            box-shadow: var(--shadow-xl);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            transition: left 0.5s ease;
        }

        .stat-item:hover::before {
            left: 100%;
        }

        .stat-item:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-2xl);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-600), var(--accent-600));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-2);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--gray-700);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Enhanced Action Bar */
        .action-bar {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            margin-bottom: var(--space-12);
            flex-wrap: wrap;
        }

        .action-btn {
            padding: var(--space-4) var(--space-6);
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: var(--white);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.95);
            color: var(--gray-800);
            border: 2px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: var(--white);
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent-500), var(--accent-600));
            color: var(--white);
        }

        .btn-accent:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn-notion {
            background: linear-gradient(135deg, #000000, #333333);
            color: var(--white);
        }

        .btn-notion:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        /* Enhanced Card Design with Better Text Contrast */
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            margin-bottom: var(--space-8);
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-500), var(--accent-500), var(--secondary-500));
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-2xl);
        }

        .card-header {
            padding: var(--space-8) var(--space-8) var(--space-6);
            border-bottom: 1px solid var(--gray-200);
            background: rgba(255, 255, 255, 0.8);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .card-subtitle {
            color: var(--gray-700);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .card-body {
            padding: var(--space-8);
            background: var(--white);
        }

        /* Enhanced Progress Section with Animation */
        .progress-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-8);
            align-items: start;
        }

        .progress-circle {
            position: relative;
            width: 220px;
            height: 220px;
            margin: 0 auto var(--space-6);
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-bg {
            fill: none;
            stroke: var(--gray-200);
            stroke-width: 12;
        }

        .progress-ring-fill {
            fill: none;
            stroke: url(#progressGradient);
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dasharray 2s cubic-bezier(0.4, 0, 0.2, 1);
            animation: progressPulse 3s ease-in-out infinite;
        }

        @keyframes progressPulse {
            0%, 100% { stroke-width: 12; }
            50% { stroke-width: 14; }
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-percentage {
            font-size: 2.25rem;
            font-weight: 800;
            color: var(--primary-600);
            line-height: 1;
        }

        .progress-label {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Animated Countdown with Seconds */
        .countdown-container {
            background: linear-gradient(135deg, var(--primary-50), var(--accent-50));
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-top: var(--space-6);
            text-align: center;
            border: 2px solid var(--primary-200);
        }

        .countdown-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: var(--space-4);
        }

        .countdown-display {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        .countdown-unit {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-3) var(--space-4);
            box-shadow: var(--shadow-md);
            min-width: 70px;
            animation: countdownFlip 1s ease-in-out infinite alternate;
        }

        @keyframes countdownFlip {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        .countdown-number {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-600);
            line-height: 1;
        }

        .countdown-label {
            font-size: 0.75rem;
            color: var(--gray-600);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Enhanced Milestone Grid */
        .milestone-grid {
            display: grid;
            gap: var(--space-4);
        }

        .milestone-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .milestone-item:hover {
            background: var(--gray-100);
            transform: translateX(6px);
            border-color: var(--primary-200);
        }

        .milestone-label {
            font-weight: 600;
            color: var(--gray-800);
        }

        .milestone-value {
            font-weight: 700;
            color: var(--gray-900);
        }

        /* Enhanced Form Design */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-8);
        }

        .form-section {
            background: var(--gray-50);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            border: 2px solid var(--gray-100);
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-6);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .input-group {
            margin-bottom: var(--space-6);
        }

        .input-label {
            display: block;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: var(--space-3);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .input-field {
            width: 100%;
            padding: var(--space-4);
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: var(--white);
            font-weight: 500;
            color: var(--gray-900);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 4px var(--primary-100);
            transform: translateY(-1px);
        }

        /* Enhanced Slider */
        .slider-container {
            position: relative;
            margin: var(--space-4) 0;
        }

        .slider {
            width: 100%;
            height: 10px;
            background: var(--gray-300);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            border-radius: 50%;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: var(--shadow-xl);
        }

        .slider-value {
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-900);
            color: var(--white);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: 0.75rem;
            font-weight: 700;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .slider:active + .slider-value,
        .slider:focus + .slider-value {
            opacity: 1;
        }

        /* Enhanced Mood Selection */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: var(--space-3);
        }

        .mood-btn {
            padding: var(--space-4);
            border: 3px solid var(--gray-300);
            border-radius: var(--radius-lg);
            background: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            color: var(--gray-800);
            position: relative;
            overflow: hidden;
        }

        .mood-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.3s ease;
        }

        .mood-btn:hover::before {
            left: 100%;
        }

        .mood-btn:hover {
            border-color: var(--primary-400);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .mood-btn.selected {
            border-color: var(--primary-500);
            background: linear-gradient(135deg, var(--primary-50), var(--primary-100));
            color: var(--primary-800);
            box-shadow: var(--shadow-lg);
        }

        .mood-emoji {
            font-size: 1.75rem;
            margin-bottom: var(--space-2);
            display: block;
        }

        /* Enhanced Selection Grid */
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--space-3);
            margin-top: var(--space-4);
        }

        .selection-btn {
            padding: var(--space-3) var(--space-4);
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-lg);
            background: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            text-align: center;
            font-weight: 600;
            color: var(--gray-800);
            position: relative;
            overflow: hidden;
        }

        .selection-btn:hover {
            border-color: var(--gray-400);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .selection-btn.selected.symptom {
            border-color: var(--error-500);
            background: linear-gradient(135deg, var(--error-50), #fef2f2);
            color: var(--error-800);
            box-shadow: var(--shadow-md);
        }

        .selection-btn.selected.exercise {
            border-color: var(--success-500);
            background: linear-gradient(135deg, var(--success-50), #f0fdf4);
            color: var(--success-800);
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Textarea */
        .textarea-field {
            width: 100%;
            padding: var(--space-4);
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-lg);
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: var(--white);
            font-weight: 500;
            color: var(--gray-900);
        }

        .textarea-field:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 4px var(--primary-100);
            transform: translateY(-1px);
        }

        /* Enhanced Goals Dashboard */
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-6);
        }

        .goal-card {
            background: var(--white);
            border: 3px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .goal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gray-300);
            transition: background 0.3s ease;
        }

        .goal-card.achieved::before {
            background: linear-gradient(90deg, var(--success-500), var(--success-600));
            animation: achievementGlow 2s ease-in-out infinite;
        }

        @keyframes achievementGlow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .goal-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-xl);
            border-color: var(--gray-300);
        }

        .goal-emoji {
            font-size: 2.75rem;
            margin-bottom: var(--space-3);
            display: block;
            transition: all 0.3s ease;
        }

        .goal-card.achieved .goal-emoji {
            transform: scale(1.15);
            animation: bounce 1s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1.15) translateY(0); }
            50% { transform: scale(1.15) translateY(-5px); }
        }

        .goal-label {
            font-size: 0.8rem;
            color: var(--gray-600);
            font-weight: 700;
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .goal-value {
            font-weight: 700;
            font-size: 1rem;
            color: var(--gray-900);
        }

        /* Enhanced Chart Container */
        .chart-container {
            position: relative;
            height: 320px;
            margin: var(--space-6) 0;
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--shadow-sm);
        }

        /* Enhanced Notification System */
        .notification {
            position: fixed;
            top: var(--space-6);
            right: var(--space-6);
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-5) var(--space-6);
            box-shadow: var(--shadow-2xl);
            transform: translateX(400px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            max-width: 380px;
            min-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 6px solid var(--success-500);
            background: linear-gradient(135deg, var(--white), var(--success-50));
        }

        .notification.warning {
            border-left: 6px solid var(--warning-500);
            background: linear-gradient(135deg, var(--white), var(--warning-50));
        }

        .notification.error {
            border-left: 6px solid var(--error-500);
            background: linear-gradient(135deg, var(--white), var(--error-50));
        }

        .notification-content {
            color: var(--gray-900);
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* Enhanced Loading Spinner */
        .loading-spinner {
            width: 22px;
            height: 22px;
            border: 3px solid var(--gray-300);
            border-top: 3px solid var(--white);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-8);
        }

        .quick-stat {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            text-align: center;
            border: 2px solid var(--gray-100);
            box-shadow: var(--shadow-sm);
        }

        .quick-stat-value {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--primary-600);
        }

        .quick-stat-label {
            font-size: 0.8rem;
            color: var(--gray-700);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Photo Upload Enhancement */
        .photo-upload {
            border: 3px dashed var(--gray-400);
            border-radius: var(--radius-xl);
            padding: var(--space-10);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--gray-50);
        }

        .photo-upload:hover {
            border-color: var(--primary-500);
            background: var(--primary-50);
            transform: translateY(-2px);
        }

        .photo-upload.dragover {
            border-color: var(--primary-500);
            background: var(--primary-100);
            transform: scale(1.02);
        }

        /* BMI Enhancement */
        .bmi-indicator {
            background: linear-gradient(135deg, var(--primary-50), var(--secondary-50));
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            text-align: center;
            margin-top: var(--space-4);
            border: 2px solid var(--primary-200);
        }

        .bmi-value {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--primary-700);
        }

        .bmi-status {
            font-size: 0.875rem;
            color: var(--gray-700);
            font-weight: 600;
        }

        /* Data Access Panel */
        .data-access-panel {
            background: linear-gradient(135deg, var(--secondary-50), var(--accent-50));
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-top: var(--space-8);
            border: 2px solid var(--secondary-200);
        }

        .data-access-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-4);
            text-align: center;
        }

        .data-access-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }

        .data-access-btn {
            background: var(--white);
            border: 2px solid var(--secondary-300);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--gray-800);
        }

        .data-access-btn:hover {
            border-color: var(--secondary-500);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* API Configuration Panel */
        .config-panel {
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .config-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-4);
        }

        .config-item {
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
        }

        .config-item label {
            display: block;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: var(--space-2);
            font-size: 0.875rem;
        }

        .config-item input {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }

        .config-item input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        /* Google Auth Button */
        .google-auth-btn {
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--gray-800);
        }

        .google-auth-btn:hover {
            border-color: var(--primary-500);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .google-auth-btn.connected {
            border-color: var(--success-500);
            background: var(--success-50);
            color: var(--success-800);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .progress-section,
            .form-grid {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
            
            .header-stats {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: var(--space-4);
            }
            
            .card-header,
            .card-body {
                padding: var(--space-6);
            }
            
            .action-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .goals-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .mode-toggle {
                position: static;
                justify-content: center;
                margin-bottom: var(--space-4);
            }
        }

        @media (max-width: 480px) {
            .app-title {
                font-size: 2rem;
            }
            
            .goals-grid {
                grid-template-columns: 1fr;
            }
            
            .mood-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Enhanced Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-40px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.08);
            }
        }

        .card {
            animation: fadeInUp 0.7s ease forwards;
        }

        .card:nth-child(2) { animation-delay: 0.1s; }
        .card:nth-child(3) { animation-delay: 0.2s; }
        .card:nth-child(4) { animation-delay: 0.3s; }
        .card:nth-child(5) { animation-delay: 0.4s; }
        .card:nth-child(6) { animation-delay: 0.5s; }

        .stat-item {
            animation: slideInLeft 0.7s ease forwards;
        }

        .stat-item:nth-child(2) { animation-delay: 0.15s; }
        .stat-item:nth-child(3) { animation-delay: 0.3s; }

        .hydration-reminder {
            animation: pulse 2.5s infinite;
        }

        .hidden {
            display: none;
        }

        /* System Integration Indicators */
        .integration-status {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-2);
        }

        .integration-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray-400);
        }

        .integration-dot.connected {
            background: var(--success-500);
            animation: pulse 2s infinite;
        }

        .integration-label {
            font-size: 0.75rem;
            color: var(--gray-600);
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Background Decorations -->
    <div class="bg-decoration bg-circle-1"></div>
    <div class="bg-decoration bg-circle-2"></div>
    <div class="bg-decoration bg-circle-3"></div>

    <!-- Mode Toggle -->
    <div class="mode-toggle">
        <span class="toggle-label">Test Mode</span>
        <div class="toggle-switch" onclick="toggleTestMode()" id="test-toggle">
            <div class="toggle-slider"></div>
        </div>
    </div>

    <div class="app-container">
        <!-- API Configuration Panel -->
        <div class="config-panel" id="config-panel">
            <h3 class="config-title">
                <span>🔧</span> API Configuration Setup
            </h3>
            <div class="config-grid">
                <div class="config-item">
                    <label for="notion-token">Notion Integration Token:</label>
                    <input type="password" id="notion-token" placeholder="Enter your Notion integration token">
                </div>
                <div class="config-item">
                    <label for="notion-database-id">Notion Database ID:</label>
                    <input type="text" id="notion-database-id" placeholder="Enter your Notion database ID">
                </div>
                <div class="config-item">
                    <label for="emailjs-service">EmailJS Service ID:</label>
                    <input type="text" id="emailjs-service" placeholder="Enter your EmailJS service ID">
                </div>
                <div class="config-item">
                    <label for="emailjs-template">EmailJS Template ID:</label>
                    <input type="text" id="emailjs-template" placeholder="Enter your EmailJS template ID">
                </div>
                <div class="config-item">
                    <label for="emailjs-user">EmailJS User ID:</label>
                    <input type="text" id="emailjs-user" placeholder="Enter your EmailJS user ID">
                </div>
                <div class="config-item">
                    <label for="google-client-id">Google Client ID:</label>
                    <input type="text" id="google-client-id" placeholder="Enter your Google OAuth Client ID">
                </div>
            </div>
            <div style="text-align: center; margin-top: var(--space-6);">
                <button class="action-btn btn-primary" onclick="saveConfig()">
                    <span>💾</span> Save Configuration
                </button>
                <button class="action-btn btn-secondary" onclick="hideConfig()">
                    <span>👁️</span> Hide Panel
                </button>
            </div>
        </div>

        <!-- Header -->
        <header class="header">
            <h1 class="app-title">Elizabeth's Journey</h1>
            <p class="app-subtitle">Your beautiful pregnancy adventure</p>
            <p class="personal-welcome">✨ Welcome back, Elizabeth! Let's track today's moments ✨</p>
            
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-number" id="weeks-display">24</div>
                    <div class="stat-label">Weeks</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="days-remaining">112</div>
                    <div class="stat-label">Days to go</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="trimester-display">2nd</div>
                    <div class="stat-label">Trimester</div>
                </div>
            </div>

            <div class="action-bar">
                <button class="action-btn btn-primary" onclick="saveEntry()">
                    <span>💕</span> Save Today's Entry
                </button>
                <button class="action-btn btn-notion" onclick="saveToNotion()">
                    <span id="notion-icon">📋</span> <span id="notion-text">Save to Notion</span>
                </button>
                <button class="action-btn btn-secondary" onclick="exportData()">
                    <span>📊</span> Export Data
                </button>
                <button class="action-btn btn-secondary" onclick="toggleReminders()">
                    <span id="reminder-icon">🔔</span> <span id="reminder-text">Enable Reminders</span>
                </button>
                <button class="action-btn btn-accent" onclick="shareWithPartner()">
                    <span>👥</span> Share with Partner
                </button>
            </div>
        </header>

        <!-- Google Authentication -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>🔐</span> Google Integration
                </h2>
                <p class="card-subtitle">Connect your Google account for Calendar, Drive, and Health sync</p>
            </div>
            <div class="card-body">
                <div class="google-auth-btn" onclick="handleGoogleAuth()" id="google-auth-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span id="google-auth-text">Connect Google Account</span>
                </div>
            </div>
        </div>

        <!-- Progress Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>👶</span> Elizabeth's Pregnancy Progress
                </h2>
                <p class="card-subtitle">Your beautiful journey milestone by milestone</p>
            </div>
            <div class="card-body">
                <div class="progress-section">
                    <div>
                        <!-- Enhanced Circular Progress -->
                        <div class="progress-circle">
                            <svg width="220" height="220" class="progress-ring">
                                <defs>
                                    <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:var(--primary-500);stop-opacity:1" />
                                        <stop offset="50%" style="stop-color:var(--accent-500);stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:var(--secondary-500);stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle cx="110" cy="110" r="95" class="progress-ring-bg"/>
                                <circle cx="110" cy="110" r="95" class="progress-ring-fill" id="progress-ring"/>
                            </svg>
                            <div class="progress-text">
                                <div class="progress-percentage" id="progress-percentage">60%</div>
                                <div class="progress-label">Complete</div>
                            </div>
                        </div>

                        <!-- Enhanced Countdown with Seconds -->
                        <div class="countdown-container">
                            <div class="countdown-title">🎯 Time Until Your Little One Arrives</div>
                            <div class="countdown-display" id="countdown-display">
                                <!-- Countdown units will be populated here -->
                            </div>
                        </div>
                    </div>
                    <div>
                        <!-- Milestones -->
                        <div class="milestone-grid">
                            <div class="milestone-item">
                                <span class="milestone-label">👶 Baby Size</span>
                                <span class="milestone-value" id="baby-size">Cantaloupe</span>
                            </div>
                            <div class="milestone-item">
                                <span class="milestone-label">📏 Length</span>
                                <span class="milestone-value" id="baby-length">~12 inches</span>
                            </div>
                            <div class="milestone-item">
                                <span class="milestone-label">⚖️ Weight</span>
                                <span class="milestone-value" id="baby-weight">~1.3 lbs</span>
                            </div>
                            <div class="milestone-item">
                                <span class="milestone-label">🎯 Due Date</span>
                                <span class="milestone-value">March 23, 2026</span>
                            </div>
                            <div class="milestone-item">
                                <span class="milestone-label">🌸 Season</span>
                                <span class="milestone-value" id="trimester-season">2nd Trimester</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Today's Entry Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>📅</span> Today's Entry
                </h2>
                <p class="card-subtitle" id="current-date">How are you feeling today, Elizabeth?</p>
            </div>
            <div class="card-body">
                <div class="form-grid">
                    <!-- Mood & Wellness -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span>💖</span> Mood & Wellness
                        </h3>
                        
                        <div class="input-group">
                            <label class="input-label">How are you feeling today?</label>
                            <div class="mood-grid">
                                <button class="mood-btn" onclick="selectMood('amazing')" id="mood-amazing">
                                    <span class="mood-emoji">🤩</span>
                                    Amazing
                                </button>
                                <button class="mood-btn" onclick="selectMood('great')" id="mood-great">
                                    <span class="mood-emoji">😊</span>
                                    Great
                                </button>
                                <button class="mood-btn" onclick="selectMood('good')" id="mood-good">
                                    <span class="mood-emoji">🙂</span>
                                    Good
                                </button>
                                <button class="mood-btn" onclick="selectMood('okay')" id="mood-okay">
                                    <span class="mood-emoji">😐</span>
                                    Okay
                                </button>
                                <button class="mood-btn" onclick="selectMood('anxious')" id="mood-anxious">
                                    <span class="mood-emoji">😰</span>
                                    Anxious
                                </button>
                                <button class="mood-btn" onclick="selectMood('tired')" id="mood-tired">
                                    <span class="mood-emoji">😴</span>
                                    Tired
                                </button>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">⚡ Energy Level</label>
                            <div class="slider-container">
                                <input type="range" min="1" max="10" value="5" class="slider" id="energy-slider" oninput="updateSliderValue(this, 'energy-value')">
                                <div class="slider-value" id="energy-value">5/10</div>
                            </div>
                        </div>
                    </div>

                    <!-- Health Metrics -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <span>📊</span> Health Metrics
                        </h3>
                        
                        <div class="input-group">
                            <label class="input-label">💧 Water Intake (glasses)</label>
                            <input type="number" min="0" max="20" placeholder="8" class="input-field" id="water-input" oninput="updateGoals()">
                        </div>

                        <div class="input-group">
                            <label class="input-label">🌙 Sleep Hours</label>
                            <input type="number" min="0" max="24" step="0.5" placeholder="7.5" class="input-field" id="sleep-input" oninput="updateGoals()">
                        </div>

                        <div class="input-group">
                            <label class="input-label">⚖️ Weight (lbs)</label>
                            <input type="number" min="80" max="300" step="0.1" placeholder="Current weight" class="input-field" id="weight-input" oninput="updateBMI()">
                        </div>

                        <div class="bmi-indicator" id="bmi-display" style="display: none;">
                            <div class="bmi-value" id="bmi-value">--</div>
                            <div class="bmi-status" id="bmi-status">BMI Status</div>
                        </div>
                    </div>
                </div>

                <!-- Symptoms Section -->
                <div class="form-section" style="margin-top: var(--space-8);">
                    <h3 class="section-title">
                        <span>🩺</span> Symptoms Today
                    </h3>
                    <div class="selection-grid" id="symptoms-grid"></div>
                </div>

                <!-- Exercise Section -->
                <div class="form-section" style="margin-top: var(--space-6);">
                    <h3 class="section-title">
                        <span>🏃‍♀️</span> Physical Activity
                    </h3>
                    <div class="selection-grid" id="exercise-grid"></div>
                </div>

                <!-- Notes Section -->
                <div class="input-group" style="margin-top: var(--space-8);">
                    <label class="input-label">
                        <span>📝</span> Notes & Thoughts
                    </label>
                    <textarea class="textarea-field" placeholder="Dear Elizabeth, how are you feeling? Any special moments, concerns, or thoughts to remember..." id="notes-input"></textarea>
                </div>

                <!-- Photo Upload -->
                <div class="input-group">
                    <label class="input-label">
                        <span>📸</span> Belly Photo (Optional)
                    </label>
                    <div class="photo-upload" onclick="document.getElementById('photo-input').click()">
                        <div style="font-size: 2.5rem; margin-bottom: var(--space-3);">📸</div>
                        <div style="font-weight: 700; margin-bottom: var(--space-2); font-size: 1.125rem; color: var(--gray-800);">Add today's photo</div>
                        <div style="font-size: 0.875rem; color: var(--gray-600);">Click to upload or drag & drop</div>
                        <input type="file" id="photo-input" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                    </div>
                </div>
            </div>
        </div>

        <!-- Goals Dashboard -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>🎯</span> Elizabeth's Daily Goals
                </h2>
                <p class="card-subtitle">Track your healthy habits for you and baby</p>
            </div>
            <div class="card-body">
                <div class="goals-grid">
                    <div class="goal-card" id="water-goal-card">
                        <span class="goal-emoji" id="water-emoji">💧</span>
                        <div class="goal-label">Hydration</div>
                        <div class="goal-value" id="water-goal">0/8 glasses</div>
                    </div>
                    <div class="goal-card" id="sleep-goal-card">
                        <span class="goal-emoji" id="sleep-emoji">😴</span>
                        <div class="goal-label">Sleep</div>
                        <div class="goal-value" id="sleep-goal">0/7+ hours</div>
                    </div>
                    <div class="goal-card" id="exercise-goal-card">
                        <span class="goal-emoji" id="exercise-emoji">🏃‍♀️</span>
                        <div class="goal-label">Activity</div>
                        <div class="goal-value" id="exercise-goal">Pending</div>
                    </div>
                    <div class="goal-card" id="energy-goal-card">
                        <span class="goal-emoji" id="energy-goal-emoji">⚡</span>
                        <div class="goal-label">Energy</div>
                        <div class="goal-value" id="energy-goal">5/10</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>📈</span> Elizabeth's Journey Analytics
                </h2>
                <p class="card-subtitle">Insights from your pregnancy tracking</p>
            </div>
            <div class="card-body">
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="total-entries">0</div>
                        <div class="quick-stat-label">Total Entries</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="avg-mood">--</div>
                        <div class="quick-stat-label">Avg Mood</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="avg-sleep">--</div>
                        <div class="quick-stat-label">Avg Sleep</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="streak-days">0</div>
                        <div class="quick-stat-label">Day Streak</div>
                    </div>
                </div>

                <!-- Weight Chart -->
                <div class="weight-chart">
                    <h3 style="margin-bottom: var(--space-4); font-weight: 700; color: var(--gray-900);">Weight Progression</h3>
                    <div class="chart-container">
                        <canvas id="weightChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Appointments Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>🗓️</span> Upcoming Appointments
                </h2>
                <p class="card-subtitle">Stay on top of your prenatal care</p>
            </div>
            <div class="card-body">
                <div class="input-group">
                    <label class="input-label">Add New Appointment</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: var(--space-3);">
                        <input type="date" class="input-field" id="appointment-date">
                        <input type="text" class="input-field" id="appointment-type" placeholder="OB Visit, Ultrasound, etc.">
                        <button class="action-btn btn-primary" onclick="addAppointment()">Add</button>
                    </div>
                </div>
                <div id="appointments-list" style="margin-top: var(--space-6);">
                    <!-- Appointments will be populated here -->
                </div>
            </div>
        </div>

        <!-- Data Access & Sharing Panel -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span>🔗</span> Data Access & System Integration
                </h2>
                <p class="card-subtitle">Share Elizabeth's journey and sync with other systems</p>
            </div>
            <div class="card-body">
                <div class="data-access-panel">
                    <div class="data-access-title">🔄 System Integrations</div>
                    <div class="data-access-grid">
                        <div class="data-access-btn" onclick="syncWithCalendar()">
                            📅 Sync with Calendar
                            <div class="integration-status">
                                <div class="integration-dot" id="calendar-status"></div>
                                <span class="integration-label" id="calendar-label">Not connected</span>
                            </div>
                        </div>
                        <div class="data-access-btn" onclick="setupEmailUpdates()">
                            📧 Email Updates
                            <div class="integration-status">
                                <div class="integration-dot" id="email-status"></div>
                                <span class="integration-label" id="email-label">Not setup</span>
                            </div>
                        </div>
                        <div class="data-access-btn" onclick="syncWithDrive()">
                            💾 Google Drive Sync
                            <div class="integration-status">
                                <div class="integration-dot" id="drive-status"></div>
                                <span class="integration-label" id="drive-label">Not connected</span>
                            </div>
                        </div>
                        <div class="data-access-btn" onclick="shareWithPartner()">
                            👥 Partner Access
                            <div class="integration-status">
                                <div class="integration-dot" id="partner-status"></div>
                                <span class="integration-label" id="partner-label">Not shared</span>
                            </div>
                        </div>
                        <div class="data-access-btn" onclick="setupCloudBackup()">
                            ☁️ Cloud Backup
                            <div class="integration-status">
                                <div class="integration-dot" id="cloud-status"></div>
                                <span class="integration-label" id="cloud-label">Not enabled</span>
                            </div>
                        </div>
                        <div class="data-access-btn" onclick="generateQRCode()">
                            📱 QR Code Access
                            <div class="integration-status">
                                <div class="integration-dot" id="qr-status"></div>
                                <span class="integration-label" id="qr-label">Generate</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Notification Toast -->
    <div id="notification" class="notification">
        <div class="notification-content" id="notification-content"></div>
    </div>

    <script>
        // Enhanced Global State with Real API Support
        let currentMood = '';
        let selectedSymptoms = [];
        let selectedExercise = [];
        let remindersEnabled = false;
        let weightChart = null;
        let prePregnancyWeight = 140;
        let isTestMode = false;
        let notificationPermission = false;
        let googleAuth = null;
        let gapi = null;
        
        // API Configuration
        let config = {
            notion: {
                token: '',
                databaseId: ''
            },
            emailjs: {
                serviceId: '',
                templateId: '',
                userId: ''
            },
            google: {
                clientId: '',
                apiKey: ''
            }
        };
        
        // Constants
        const lmpDate = new Date(2025, 5, 16); // June 16, 2025
        const dueDate = new Date(2026, 2, 23); // March 23, 2026
        
        const symptoms = [
            'Morning Sickness', 'Fatigue', 'Tender Breasts', 'Cramping', 'Bloating', 
            'Food Aversions', 'Cravings', 'Heartburn', 'Back Pain', 'Headache', 
            'Frequent Urination', 'Mood Swings', 'Dizziness', 'Hot Flashes',
            'Swelling', 'Shortness of Breath', 'Constipation', 'Insomnia',
            'Round Ligament Pain', 'Varicose Veins'
        ];
        
        const exercises = [
            'Walking', 'Prenatal Yoga', 'Swimming', 'Stretching', 'Light Weights',
            'Pilates', 'Stationary Bike', 'Rest Day', 'Meditation', 'Breathing Exercises',
            'Kegel Exercises', 'Prenatal Massage'
        ];
        
        const babySizes = {
            4: {size: 'Poppy Seed', length: '0.2"', weight: '0.001 oz'},
            5: {size: 'Apple Seed', length: '0.3"', weight: '0.003 oz'},
            8: {size: 'Raspberry', length: '0.6"', weight: '0.04 oz'},
            12: {size: 'Lime', length: '2.1"', weight: '0.5 oz'},
            16: {size: 'Avocado', length: '4.6"', weight: '3.5 oz'},
            20: {size: 'Banana', length: '6.5"', weight: '10.2 oz'},
            24: {size: 'Cantaloupe', length: '11.8"', weight: '1.3 lbs'},
            28: {size: 'Eggplant', length: '14.8"', weight: '2.2 lbs'},
            32: {size: 'Jicama', length: '16.7"', weight: '3.8 lbs'},
            36: {size: 'Romaine Lettuce', length: '18.7"', weight: '5.8 lbs'},
            40: {size: 'Small Pumpkin', length: '20.2"', weight: '7.6 lbs'}
        };

        // Enhanced Storage with Test Mode Support
        function getStorageKey(suffix = '') {
            const mode = isTestMode ? 'Test' : 'Real';
            return `elizabethPregnancy${mode}${suffix}`;
        }

        // Configuration Management
        function loadConfig() {
            const savedConfig = localStorage.getItem('pregnancyTrackerConfig');
            if (savedConfig) {
                config = { ...config, ...JSON.parse(savedConfig) };
                
                // Populate form fields
                document.getElementById('notion-token').value = config.notion?.token || '';
                document.getElementById('notion-database-id').value = config.notion?.databaseId || '';
                document.getElementById('emailjs-service').value = config.emailjs?.serviceId || '';
                document.getElementById('emailjs-template').value = config.emailjs?.templateId || '';
                document.getElementById('emailjs-user').value = config.emailjs?.userId || '';
                document.getElementById('google-client-id').value = config.google?.clientId || '';
                
                // Initialize services
                if (config.emailjs?.userId) {
                    emailjs.init(config.emailjs.userId);
                }
                
                if (config.google?.clientId) {
                    initializeGoogleAuth();
                }
            }
        }

        function saveConfig() {
            config.notion.token = document.getElementById('notion-token').value;
            config.notion.databaseId = document.getElementById('notion-database-id').value;
            config.emailjs.serviceId = document.getElementById('emailjs-service').value;
            config.emailjs.templateId = document.getElementById('emailjs-template').value;
            config.emailjs.userId = document.getElementById('emailjs-user').value;
            config.google.clientId = document.getElementById('google-client-id').value;
            
            localStorage.setItem('pregnancyTrackerConfig', JSON.stringify(config));
            
            // Initialize services
            if (config.emailjs.userId) {
                emailjs.init(config.emailjs.userId);
            }
            
            if (config.google.clientId) {
                initializeGoogleAuth();
            }
            
            showNotification('✅ Configuration saved successfully!', 'success');
        }

        function hideConfig() {
            document.getElementById('config-panel').style.display = 'none';
        }

        // Google Authentication
        function initializeGoogleAuth() {
            if (!config.google.clientId) return;
            
            window.google.accounts.id.initialize({
                client_id: config.google.clientId,
                callback: handleGoogleAuthResponse
            });
            
            // Initialize GAPI
            gapi.load('client:auth2', () => {
                gapi.client.init({
                    apiKey: config.google.apiKey,
                    clientId: config.google.clientId,
                    discoveryDocs: [
                        'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest',
                        'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'
                    ],
                    scope: 'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/drive.file'
                }).then(() => {
                    googleAuth = gapi.auth2.getAuthInstance();
                    updateGoogleAuthButton();
                });
            });
        }

        function handleGoogleAuth() {
            if (!googleAuth) {
                showNotification('❌ Google authentication not initialized. Please configure your Google Client ID.', 'error');
                return;
            }
            
            if (googleAuth.isSignedIn.get()) {
                googleAuth.signOut();
            } else {
                googleAuth.signIn();
            }
            updateGoogleAuthButton();
        }

        function handleGoogleAuthResponse(response) {
            updateGoogleAuthButton();
            showNotification('✅ Google authentication successful!', 'success');
        }

        function updateGoogleAuthButton() {
            const btn = document.getElementById('google-auth-btn');
            const text = document.getElementById('google-auth-text');
            
            if (googleAuth && googleAuth.isSignedIn.get()) {
                btn.classList.add('connected');
                text.textContent = 'Google Connected ✓';
                
                // Enable integrations that require Google auth
                saveIntegrationStatus('calendar', true);
                saveIntegrationStatus('drive', true);
            } else {
                btn.classList.remove('connected');
                text.textContent = 'Connect Google Account';
            }
        }

        // Real Google Calendar Integration
        async function syncWithCalendar() {
            if (!googleAuth || !googleAuth.isSignedIn.get()) {
                showNotification('❌ Please connect your Google account first.', 'error');
                return;
            }
            
            showNotification('📅 Syncing with Google Calendar...', 'success');
            
            try {
                const storageKey = getStorageKey('Appointments');
                const appointments = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                for (const apt of appointments) {
                    const event = {
                        summary: `Elizabeth's ${apt.type}`,
                        description: `Pregnancy appointment: ${apt.type}${apt.testMode ? ' (Test Mode)' : ''}`,
                        start: {
                            date: apt.date
                        },
                        end: {
                            date: apt.date
                        },
                        colorId: '10' // Light green for pregnancy appointments
                    };
                    
                    await gapi.client.calendar.events.insert({
                        calendarId: 'primary',
                        resource: event
                    });
                }
                
                saveIntegrationStatus('calendar', true);
                showNotification('📅 Calendar sync completed! All appointments added to Google Calendar.', 'success');
                
            } catch (error) {
                console.error('Calendar sync error:', error);
                showNotification('❌ Calendar sync failed. Please try again.', 'error');
            }
        }

        // Real Email Integration using EmailJS
        async function setupEmailUpdates() {
            if (!config.emailjs.serviceId || !config.emailjs.templateId) {
                showNotification('❌ EmailJS not configured. Please set up your EmailJS credentials.', 'error');
                return;
            }
            
            const email = prompt('Enter email address for weekly pregnancy updates:');
            if (!email || !email.includes('@')) {
                if (email) showNotification('Please enter a valid email address.', 'error');
                return;
            }
            
            showNotification('📧 Setting up email updates...', 'success');
            
            try {
                // Test email send
                const testEmailData = {
                    to_email: email,
                    to_name: 'Elizabeth',
                    subject: 'Welcome to Elizabeth\'s Pregnancy Journey',
                    message: `Welcome to Elizabeth's pregnancy tracking updates! You'll receive weekly summaries of her journey.
                    
                    Current Status:
                    - Week: ${Math.floor((new Date() - lmpDate) / (1000 * 60 * 60 * 24 * 7))}
                    - Due Date: March 23, 2026
                    - Mode: ${isTestMode ? 'Test' : 'Real Tracking'}
                    
                    This is a test email to confirm your subscription.`
                };
                
                await emailjs.send(
                    config.emailjs.serviceId,
                    config.emailjs.templateId,
                    testEmailData
                );
                
                saveIntegrationStatus('email', true);
                localStorage.setItem(getStorageKey('EmailAddress'), email);
                showNotification(`📧 Email updates enabled for ${email}! Test email sent.`, 'success');
                
                // Schedule weekly emails
                scheduleWeeklyEmails(email);
                
            } catch (error) {
                console.error('Email setup error:', error);
                showNotification('❌ Email setup failed. Please check your EmailJS configuration.', 'error');
            }
        }

        function scheduleWeeklyEmails(email) {
            // This would typically be handled by a backend service
            // For demo purposes, we'll show a notification
            showNotification('📧 Weekly email reminders scheduled!', 'success');
        }

        // Real Google Drive Integration
        async function syncWithDrive() {
            if (!googleAuth || !googleAuth.isSignedIn.get()) {
                showNotification('❌ Please connect your Google account first.', 'error');
                return;
            }
            
            showNotification('💾 Syncing with Google Drive...', 'success');
            
            try {
                // Create folder for pregnancy data
                const folderMetadata = {
                    name: `Elizabeth's Pregnancy Journey ${isTestMode ? '(Test)' : ''}`,
                    mimeType: 'application/vnd.google-apps.folder'
                };
                
                const folder = await gapi.client.drive.files.create({
                    resource: folderMetadata
                });
                
                // Upload current data as JSON
                const storageKey = getStorageKey('Data');
                const pregnancyData = localStorage.getItem(storageKey) || '{}';
                
                const fileMetadata = {
                    name: `pregnancy-data-${new Date().toISOString().split('T')[0]}.json`,
                    parents: [folder.result.id]
                };
                
                const media = {
                    mimeType: 'application/json',
                    body: pregnancyData
                };
                
                await gapi.client.request({
                    path: 'https://www.googleapis.com/upload/drive/v3/files',
                    method: 'POST',
                    params: {
                        uploadType: 'multipart'
                    },
                    headers: {
                        'Content-Type': 'multipart/related; boundary="foo_bar_baz"'
                    },
                    body: createMultipartBody(fileMetadata, media)
                });
                
                // Upload photos if any exist
                const photosKey = getStorageKey('Photos');
                const photos = JSON.parse(localStorage.getItem(photosKey) || '{}');
                
                for (const [date, photoData] of Object.entries(photos)) {
                    const photoBlob = dataURLtoBlob(photoData.data);
                    const photoMetadata = {
                        name: `elizabeth-photo-${date}.jpg`,
                        parents: [folder.result.id]
                    };
                    
                    // Upload photo (simplified - in production would use proper upload)
                    console.log(`Would upload photo for ${date}`);
                }
                
                saveIntegrationStatus('drive', true);
                showNotification('💾 Google Drive sync completed! Data backed up successfully.', 'success');
                
            } catch (error) {
                console.error('Drive sync error:', error);
                showNotification('❌ Google Drive sync failed. Please try again.', 'error');
            }
        }

        function createMultipartBody(metadata, data) {
            const delimiter = 'foo_bar_baz';
            let body = `--${delimiter}\r\n`;
            body += 'Content-Type: application/json\r\n\r\n';
            body += JSON.stringify(metadata) + '\r\n';
            body += `--${delimiter}\r\n`;
            body += `Content-Type: ${data.mimeType}\r\n\r\n`;
            body += data.body + '\r\n';
            body += `--${delimiter}--`;
            return body;
        }

        function dataURLtoBlob(dataURL) {
            const arr = dataURL.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }

        // Real Notion Integration
        async function saveToNotion() {
            if (!config.notion.token || !config.notion.databaseId) {
                showNotification('❌ Notion not configured. Please set up your Notion integration token and database ID.', 'error');
                return;
            }
            
            const notionIcon = document.getElementById('notion-icon');
            const notionText = document.getElementById('notion-text');
            
            // Show loading state
            notionIcon.innerHTML = '<div class="loading-spinner"></div>';
            notionText.textContent = 'Saving to Notion...';
            
            try {
                const today = new Date().toISOString().split('T')[0];
                const daysSinceConception = Math.floor((new Date() - lmpDate) / (1000 * 60 * 60 * 24));
                const weeksComplete = Math.floor(daysSinceConception / 7);
                const extraDays = daysSinceConception % 7;
                
                const modePrefix = isTestMode ? '[TEST] ' : '';
                const notionData = {
                    parent: { database_id: config.notion.databaseId },
                    properties: {
                        "Name": {
                            title: [{ text: { content: `${modePrefix}Elizabeth's Entry - ${today}` } }]
                        },
                        "Date": {
                            date: { start: today }
                        },
                        "Week": {
                            rich_text: [{ text: { content: `${weeksComplete}w ${extraDays}d` } }]
                        },
                        "Mood": {
                            select: currentMood ? { name: currentMood } : null
                        },
                        "Energy": {
                            number: parseInt(document.getElementById('energy-slider').value)
                        },
                        "Water": {
                            number: parseInt(document.getElementById('water-input').value) || 0
                        },
                        "Sleep": {
                            number: parseFloat(document.getElementById('sleep-input').value) || 0
                        },
                        "Weight": {
                            number: parseFloat(document.getElementById('weight-input').value) || null
                        },
                        "Symptoms": {
                            multi_select: selectedSymptoms.map(symptom => ({ name: symptom }))
                        },
                        "Exercise": {
                            multi_select: selectedExercise.map(exercise => ({ name: exercise }))
                        },
                        "Notes": {
                            rich_text: [{ text: { content: `${modePrefix}${document.getElementById('notes-input').value || ''}` } }]
                        },
                        "Mode": {
                            select: { name: isTestMode ? 'Test' : 'Real' }
                        }
                    }
                };

                const response = await fetch('https://api.notion.com/v1/pages', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${config.notion.token}`,
                        'Content-Type': 'application/json',
                        'Notion-Version': '2022-06-28'
                    },
                    body: JSON.stringify(notionData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                showNotification('🎉 Successfully saved to Notion!', 'success');
                notionIcon.textContent = '✅';
                notionText.textContent = 'Saved to Notion';
                
                setTimeout(() => {
                    notionIcon.textContent = '📋';
                    notionText.textContent = 'Save to Notion';
                }, 3000);
                
            } catch (error) {
                console.error('Error saving to Notion:', error);
                showNotification('❌ Failed to save to Notion. Please check your configuration and try again.', 'error');
                notionIcon.textContent = '❌';
                notionText.textContent = 'Error';
                
                setTimeout(() => {
                    notionIcon.textContent = '📋';
                    notionText.textContent = 'Save to Notion';
                }, 3000);
            }
        }

        // Enhanced Photo Upload with Google Drive
        async function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    // Store photo data in localStorage
                    const today = new Date().toISOString().split('T')[0];
                    const storageKey = getStorageKey('Photos');
                    const photos = JSON.parse(localStorage.getItem(storageKey) || '{}');
                    photos[today] = {
                        data: e.target.result,
                        timestamp: new Date().toISOString(),
                        testMode: isTestMode,
                        filename: file.name
                    };
                    localStorage.setItem(storageKey, JSON.stringify(photos));
                    
                    showNotification('📸 Photo saved successfully for Elizabeth!', 'success');
                    
                    // Auto-upload to Google Drive if connected
                    if (googleAuth && googleAuth.isSignedIn.get()) {
                        try {
                            showNotification('☁️ Uploading photo to Google Drive...', 'success');
                            // Implementation would go here for real Google Drive upload
                            setTimeout(() => {
                                showNotification('✅ Photo uploaded to Google Drive!', 'success');
                            }, 2000);
                        } catch (error) {
                            console.error('Photo upload error:', error);
                        }
                    }
                    
                    // Update upload area to show success
                    const uploadArea = document.querySelector('.photo-upload');
                    uploadArea.innerHTML = `
                        <div style="font-size: 2.5rem; margin-bottom: var(--space-3);">✅</div>
                        <div style="font-weight: 700; margin-bottom: var(--space-2); font-size: 1.125rem; color: var(--success-600);">Photo saved!</div>
                        <div style="font-size: 0.875rem; color: var(--gray-600);">Click to upload a different photo</div>
                    `;
                    
                    setTimeout(() => {
                        uploadArea.innerHTML = `
                            <div style="font-size: 2.5rem; margin-bottom: var(--space-3);">📸</div>
                            <div style="font-weight: 700; margin-bottom: var(--space-2); font-size: 1.125rem; color: var(--gray-800);">Add today's photo</div>
                            <div style="font-size: 0.875rem; color: var(--gray-600);">Click to upload or drag & drop</div>
                        `;
                    }, 5000);
                };
                reader.readAsDataURL(file);
            } else {
                showNotification('Please select an image file.', 'error');
            }
        }

        // Enhanced Initialize App
        function init() {
            loadConfig();
            updateCurrentDate();
            updateProgress();
            updateCountdown();
            createSymptomButtons();
            createExerciseButtons();
            updateGoals();
            loadTodaysEntry();
            updateAnalytics();
            initializeWeightChart();
            loadAppointments();
            checkReminders();
            requestNotificationPermission();
            loadSystemIntegrations();
            
            // Setup auto-save
            setupAutoSave();
            
            // Setup drag and drop for photos
            setupPhotoDragDrop();

            // Start countdown timer with seconds
            setInterval(updateCountdown, 1000); // Update every second
        }

        function toggleTestMode() {
            isTestMode = !isTestMode;
            const toggle = document.getElementById('test-toggle');
            
            if (isTestMode) {
                toggle.classList.add('active');
                showNotification('🧪 Test Mode Active - Your entries are separate from real data', 'warning');
            } else {
                toggle.classList.remove('active');
                showNotification('✅ Real Mode Active - Tracking Elizabeth\'s actual pregnancy', 'success');
            }
            
            // Reload data for current mode
            loadTodaysEntry();
            updateAnalytics();
            loadAppointments();
        }

        function updateCurrentDate() {
            const today = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('current-date').textContent = 
                `Today is ${today.toLocaleDateString('en-US', options)}`;
        }

        function updateProgress() {
            const today = new Date();
            const daysSinceConception = Math.floor((today - lmpDate) / (1000 * 60 * 60 * 24));
            const weeksComplete = Math.floor(daysSinceConception / 7);
            const daysUntilDue = Math.floor((dueDate - today) / (1000 * 60 * 60 * 24));
            
            // Update header stats
            document.getElementById('weeks-display').textContent = weeksComplete;
            document.getElementById('days-remaining').textContent = daysUntilDue;
            
            // Determine trimester
            let trimester;
            if (daysSinceConception <= 91) {
                trimester = '1st';
                document.getElementById('trimester-season').textContent = '1st Trimester 🌱';
            } else if (daysSinceConception <= 196) {
                trimester = '2nd';
                document.getElementById('trimester-season').textContent = '2nd Trimester 🌸';
            } else {
                trimester = '3rd';
                document.getElementById('trimester-season').textContent = '3rd Trimester 🌻';
            }
            document.getElementById('trimester-display').textContent = trimester;
            
            // Update baby size
            const babyData = babySizes[weeksComplete] || {size: 'Growing Strong', length: '--', weight: '--'};
            document.getElementById('baby-size').textContent = babyData.size;
            document.getElementById('baby-length').textContent = babyData.length;
            document.getElementById('baby-weight').textContent = babyData.weight;
            
            // Update circular progress
            const progressPercentage = Math.min(Math.round((daysSinceConception / 280) * 100), 100);
            document.getElementById('progress-percentage').textContent = `${progressPercentage}%`;
            
            // Update SVG circle
            const circle = document.getElementById('progress-ring');
            const radius = 95;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (progressPercentage / 100) * circumference;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
        }

        function updateCountdown() {
            const now = new Date();
            const timeRemaining = dueDate - now;
            
            const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
            
            const countdownDisplay = document.getElementById('countdown-display');
            countdownDisplay.innerHTML = `
                <div class="countdown-unit">
                    <div class="countdown-number">${days}</div>
                    <div class="countdown-label">Days</div>
                </div>
                <div class="countdown-unit">
                    <div class="countdown-number">${hours}</div>
                    <div class="countdown-label">Hours</div>
                </div>
                <div class="countdown-unit">
                    <div class="countdown-number">${minutes}</div>
                    <div class="countdown-label">Minutes</div>
                </div>
                <div class="countdown-unit">
                    <div class="countdown-number">${seconds}</div>
                    <div class="countdown-label">Seconds</div>
                </div>
            `;
        }

        function createSymptomButtons() {
            const grid = document.getElementById('symptoms-grid');
            grid.innerHTML = '';
            symptoms.forEach(symptom => {
                const btn = document.createElement('button');
                btn.className = 'selection-btn symptom';
                btn.textContent = symptom;
                btn.onclick = () => toggleSymptom(symptom);
                btn.id = `symptom-${symptom.replace(/\s+/g, '-').toLowerCase()}`;
                grid.appendChild(btn);
            });
        }

        function createExerciseButtons() {
            const grid = document.getElementById('exercise-grid');
            grid.innerHTML = '';
            exercises.forEach(exercise => {
                const btn = document.createElement('button');
                btn.className = 'selection-btn exercise';
                btn.textContent = exercise;
                btn.onclick = () => toggleExercise(exercise);
                btn.id = `exercise-${exercise.replace(/\s+/g, '-').toLowerCase()}`;
                grid.appendChild(btn);
            });
        }

        function selectMood(mood) {
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById(`mood-${mood}`).classList.add('selected');
            currentMood = mood;
            autoSave();
        }

        function toggleSymptom(symptom) {
            const btn = document.getElementById(`symptom-${symptom.replace(/\s+/g, '-').toLowerCase()}`);
            if (selectedSymptoms.includes(symptom)) {
                selectedSymptoms = selectedSymptoms.filter(s => s !== symptom);
                btn.classList.remove('selected');
            } else {
                selectedSymptoms.push(symptom);
                btn.classList.add('selected');
            }
            autoSave();
        }

        function toggleExercise(exercise) {
            const btn = document.getElementById(`exercise-${exercise.replace(/\s+/g, '-').toLowerCase()}`);
            if (selectedExercise.includes(exercise)) {
                selectedExercise = selectedExercise.filter(e => e !== exercise);
                btn.classList.remove('selected');
            } else {
                selectedExercise.push(exercise);
                btn.classList.add('selected');
            }
            updateGoals();
            autoSave();
        }

        function updateSliderValue(slider, displayId) {
            const value = slider.value;
            document.getElementById(displayId).textContent = `${value}/10`;
            if (displayId === 'energy-value') {
                document.getElementById('energy-goal').textContent = `${value}/10`;
                const goalCard = document.getElementById('energy-goal-card');
                goalCard.classList.toggle('achieved', value >= 6);
            }
            autoSave();
        }

        function updateGoals() {
            const water = parseInt(document.getElementById('water-input').value) || 0;
            const sleep = parseFloat(document.getElementById('sleep-input').value) || 0;
            
            document.getElementById('water-goal').textContent = `${water}/8 glasses`;
            document.getElementById('sleep-goal').textContent = `${sleep}/7+ hours`;
            document.getElementById('exercise-goal').textContent = selectedExercise.length > 0 ? 'Completed!' : 'Pending';
            
            // Update goal cards
            const waterCard = document.getElementById('water-goal-card');
            const sleepCard = document.getElementById('sleep-goal-card');
            const exerciseCard = document.getElementById('exercise-goal-card');
            
            waterCard.classList.toggle('achieved', water >= 8);
            sleepCard.classList.toggle('achieved', sleep >= 7);
            exerciseCard.classList.toggle('achieved', selectedExercise.length > 0);
            
            // Enhanced hydration reminder
            if (water < 4 && water > 0) {
                waterCard.classList.add('hydration-reminder');
                if (remindersEnabled && notificationPermission) {
                    sendBrowserNotification('💧 Hydration Reminder', 'Elizabeth, remember to drink more water today!');
                }
            } else {
                waterCard.classList.remove('hydration-reminder');
            }
        }

        function updateBMI() {
            const currentWeight = parseFloat(document.getElementById('weight-input').value);
            if (!currentWeight) {
                document.getElementById('bmi-display').style.display = 'none';
                return;
            }
            
            // Assuming average height of 5'5" (65 inches) - should be user configurable
            const heightInInches = 65;
            const bmi = (currentWeight / (heightInInches * heightInInches)) * 703;
            const weightGain = currentWeight - prePregnancyWeight;
            
            document.getElementById('bmi-value').textContent = bmi.toFixed(1);
            
            let status = '';
            if (bmi < 18.5) status = 'Underweight';
            else if (bmi < 25) status = 'Normal Weight';
            else if (bmi < 30) status = 'Overweight';
            else status = 'Obese';
            
            document.getElementById('bmi-status').textContent = `${status} • +${weightGain.toFixed(1)} lbs total`;
            document.getElementById('bmi-display').style.display = 'block';
            
            // Update weight chart
            updateWeightChart(currentWeight);
            autoSave();
        }

        function saveEntry() {
            const today = new Date().toISOString().split('T')[0];
            const entry = {
                date: today,
                mood: currentMood,
                energy: document.getElementById('energy-slider').value,
                water: parseInt(document.getElementById('water-input').value) || 0,
                sleep: parseFloat(document.getElementById('sleep-input').value) || 0,
                weight: parseFloat(document.getElementById('weight-input').value) || null,
                symptoms: selectedSymptoms,
                exercise: selectedExercise,
                notes: document.getElementById('notes-input').value,
                timestamp: new Date().toISOString(),
                testMode: isTestMode
            };
            
            const storageKey = getStorageKey('Data');
            const savedData = JSON.parse(localStorage.getItem(storageKey) || '{}');
            savedData[today] = entry;
            localStorage.setItem(storageKey, JSON.stringify(savedData));
            
            updateAnalytics();
            const modeText = isTestMode ? 'test entry' : 'entry for Elizabeth';
            showNotification(`✅ Today's ${modeText} saved successfully!`, 'success');
            
            if (notificationPermission && !isTestMode) {
                sendBrowserNotification('💕 Entry Saved', 'Elizabeth\'s daily tracking has been saved!');
            }

            // Auto-backup to Google Drive if connected
            if (googleAuth && googleAuth.isSignedIn.get()) {
                setTimeout(() => {
                    syncWithDrive();
                }, 1000);
            }
        }

        function exportData() {
            const storageKey = getStorageKey('Data');
            const savedData = JSON.parse(localStorage.getItem(storageKey) || '{}');
            const entries = Object.values(savedData);
            
            if (entries.length === 0) {
                showNotification('No data to export yet. Start tracking first!', 'warning');
                return;
            }
            
            // Create enhanced CSV
            const csvHeaders = ['Date', 'Week', 'Mood', 'Energy', 'Water', 'Sleep', 'Weight', 'Symptoms', 'Exercise', 'Notes', 'Mode'];
            const csvRows = entries.map(entry => {
                const daysSinceConception = Math.floor((new Date(entry.date) - lmpDate) / (1000 * 60 * 60 * 24));
                const weeksComplete = Math.floor(daysSinceConception / 7);
                const extraDays = daysSinceConception % 7;
                
                return [
                    entry.date,
                    `${weeksComplete}w ${extraDays}d`,
                    entry.mood || '',
                    entry.energy || '',
                    entry.water || '',
                    entry.sleep || '',
                    entry.weight || '',
                    (entry.symptoms || []).join('; '),
                    (entry.exercise || []).join('; '),
                    entry.notes || '',
                    entry.testMode ? 'Test' : 'Real'
                ].map(field => `"${String(field).replace(/"/g, '""')}"`);
            });
            
            const csvContent = [csvHeaders, ...csvRows].map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            const modeText = isTestMode ? 'test-' : '';
            a.download = `elizabeth-pregnancy-${modeText}tracker-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('📊 Elizabeth\'s data exported successfully!', 'success');
        }

        function toggleReminders() {
            remindersEnabled = !remindersEnabled;
            const icon = document.getElementById('reminder-icon');
            const text = document.getElementById('reminder-text');
            
            if (remindersEnabled) {
                icon.textContent = '🔔';
                text.textContent = 'Reminders On';
                showNotification('🔔 Reminders enabled for Elizabeth!', 'success');
                scheduleReminders();
                requestNotificationPermission();
            } else {
                icon.textContent = '🔕';
                text.textContent = 'Reminders Off';
                showNotification('🔕 Reminders disabled.', 'warning');
            }
            
            localStorage.setItem(getStorageKey('RemindersEnabled'), remindersEnabled);
        }

        function requestNotificationPermission() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    notificationPermission = permission === 'granted';
                    if (!notificationPermission) {
                        showNotification('💡 Enable browser notifications for better reminders!', 'warning');
                    }
                });
            }
        }

        function sendBrowserNotification(title, body) {
            if (notificationPermission) {
                new Notification(title, {
                    body: body,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">👶</text></svg>'
                });
            }
        }

        function scheduleReminders() {
            if (!remindersEnabled) return;
            
            const now = new Date();
            const reminderTimes = [
                { hour: 9, message: '🌅 Good morning, Elizabeth! Time to track your mood and energy.' },
                { hour: 14, message: '💧 Hydration check! Have you had enough water today, Elizabeth?' },
                { hour: 20, message: '📝 Evening reflection time. How was your day, Elizabeth?' }
            ];
            
            reminderTimes.forEach(({ hour, message }) => {
                const reminderTime = new Date(now);
                reminderTime.setHours(hour, 0, 0, 0);
                
                if (reminderTime <= now) {
                    reminderTime.setDate(reminderTime.getDate() + 1);
                }
                
                const timeUntilReminder = reminderTime.getTime() - now.getTime();
                setTimeout(() => {
                    showNotification(message, 'success');
                    if (notificationPermission) {
                        sendBrowserNotification('Pregnancy Tracker Reminder', message);
                    }
                    scheduleReminders(); // Reschedule for next day
                }, timeUntilReminder);
            });
        }

        function checkReminders() {
            const savedReminders = localStorage.getItem(getStorageKey('RemindersEnabled'));
            if (savedReminders === 'true') {
                remindersEnabled = true;
                document.getElementById('reminder-icon').textContent = '🔔';
                document.getElementById('reminder-text').textContent = 'Reminders On';
                scheduleReminders();
                requestNotificationPermission();
            }
        }

        function addAppointment() {
            const date = document.getElementById('appointment-date').value;
            const type = document.getElementById('appointment-type').value;
            
            if (!date || !type) {
                showNotification('Please fill in both date and appointment type.', 'warning');
                return;
            }
            
            const storageKey = getStorageKey('Appointments');
            const appointments = JSON.parse(localStorage.getItem(storageKey) || '[]');
            appointments.push({
                date: date,
                type: type,
                id: Date.now(),
                testMode: isTestMode
            });
            
            appointments.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem(storageKey, JSON.stringify(appointments));
            
            document.getElementById('appointment-date').value = '';
            document.getElementById('appointment-type').value = '';
            
            loadAppointments();
            showNotification('📅 Appointment added successfully!', 'success');

            // Auto-sync with Google Calendar if connected
            if (googleAuth && googleAuth.isSignedIn.get()) {
                setTimeout(() => {
                    syncWithCalendar();
                }, 500);
            }
        }

        function loadAppointments() {
            const storageKey = getStorageKey('Appointments');
            const appointments = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const container = document.getElementById('appointments-list');
            
            if (appointments.length === 0) {
                container.innerHTML = '<p style="color: var(--gray-600); text-align: center; padding: var(--space-8); font-weight: 500;">No upcoming appointments. Add one above!</p>';
                return;
            }
            
            const now = new Date();
            container.innerHTML = appointments
                .filter(apt => new Date(apt.date) >= now)
                .slice(0, 5)
                .map(apt => {
                    const aptDate = new Date(apt.date);
                    const daysUntil = Math.ceil((aptDate - now) / (1000 * 60 * 60 * 24));
                    const modeIndicator = apt.testMode ? ' 🧪' : '';
                    
                    return `
                        <div class="milestone-item" style="margin-bottom: var(--space-3);">
                            <div>
                                <div style="font-weight: 700; color: var(--gray-900);">${apt.type}${modeIndicator}</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600); font-weight: 500;">
                                    ${aptDate.toLocaleDateString()} (${daysUntil} days)
                                </div>
                            </div>
                            <button class="btn-secondary" onclick="removeAppointment(${apt.id})" style="padding: var(--space-2) var(--space-3); font-size: 0.75rem; font-weight: 600;">Remove</button>
                        </div>
                    `;
                })
                .join('');
        }

        function removeAppointment(id) {
            const storageKey = getStorageKey('Appointments');
            const appointments = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const filtered = appointments.filter(apt => apt.id !== id);
            localStorage.setItem(storageKey, JSON.stringify(filtered));
            loadAppointments();
            showNotification('Appointment removed.', 'success');
        }

        function updateAnalytics() {
            const storageKey = getStorageKey('Data');
            const savedData = JSON.parse(localStorage.getItem(storageKey) || '{}');
            const entries = Object.values(savedData);
            
            document.getElementById('total-entries').textContent = entries.length;
            
            if (entries.length === 0) {
                document.getElementById('avg-mood').textContent = '--';
                document.getElementById('avg-sleep').textContent = '--';
                document.getElementById('streak-days').textContent = '0';
                return;
            }
            
            // Calculate averages
            const moodValues = { amazing: 5, great: 4, good: 3, okay: 2, anxious: 1, tired: 1 };
            const avgMoodValue = entries
                .filter(e => e.mood)
                .reduce((sum, e) => sum + (moodValues[e.mood] || 3), 0) / 
                entries.filter(e => e.mood).length;
            
            const moodLabels = ['Poor', 'Fair', 'Good', 'Great', 'Amazing'];
            document.getElementById('avg-mood').textContent = moodLabels[Math.round(avgMoodValue) - 1] || '--';
            
            const avgSleep = entries
                .filter(e => e.sleep)
                .reduce((sum, e) => sum + parseFloat(e.sleep), 0) / 
                entries.filter(e => e.sleep).length;
            
            document.getElementById('avg-sleep').textContent = avgSleep ? `${avgSleep.toFixed(1)}h` : '--';
            
            // Calculate streak
            const sortedDates = Object.keys(savedData).sort().reverse();
            let streak = 0;
            
            for (let i = 0; i < sortedDates.length; i++) {
                const expectedDate = new Date();
                expectedDate.setDate(expectedDate.getDate() - i);
                const expectedDateStr = expectedDate.toISOString().split('T')[0];
                
                if (sortedDates[i] === expectedDateStr) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('streak-days').textContent = streak;
        }

        function initializeWeightChart() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            const storageKey = getStorageKey('Data');
            const savedData = JSON.parse(localStorage.getItem(storageKey) || '{}');
            const entries = Object.values(savedData)
                .filter(e => e.weight)
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const labels = entries.map(e => new Date(e.date).toLocaleDateString());
            const weights = entries.map(e => e.weight);
            
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Weight (lbs)',
                        data: weights,
                        borderColor: 'var(--primary-500)',
                        backgroundColor: 'var(--primary-100)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: 'var(--primary-600)',
                        pointBorderColor: 'var(--white)',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Weight (lbs)',
                                font: { weight: 600 }
                            },
                            grid: {
                                color: 'var(--gray-200)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date',
                                font: { weight: 600 }
                            },
                            grid: {
                                color: 'var(--gray-200)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'var(--gray-900)',
                            titleColor: 'var(--white)',
                            bodyColor: 'var(--white)',
                            borderColor: 'var(--primary-500)',
                            borderWidth: 2,
                            cornerRadius: 8
                        }
                    }
                }
            });
        }

        function updateWeightChart(newWeight) {
            if (!weightChart) return;
            
            const today = new Date().toLocaleDateString();
            const data = weightChart.data;
            
            // Check if today's entry already exists
            const todayIndex = data.labels.indexOf(today);
            if (todayIndex !== -1) {
                data.datasets[0].data[todayIndex] = newWeight;
            } else {
                data.labels.push(today);
                data.datasets[0].data.push(newWeight);
            }
            
            weightChart.update('active');
        }

        function setupAutoSave() {
            // Auto-save every 30 seconds if there are changes
            setInterval(autoSave, 30000);
            
            // Save on form field changes
            ['water-input', 'sleep-input', 'weight-input', 'notes-input'].forEach(id => {
                document.getElementById(id).addEventListener('input', autoSave);
            });
            
            document.getElementById('energy-slider').addEventListener('input', autoSave);
        }

        function autoSave() {
            const today = new Date().toISOString().split('T')[0];
            const storageKey = getStorageKey('Data');
            const savedData = JSON.parse(localStorage.getItem(storageKey) || '{}');
            
            // Only auto-save if there's existing data for today or if user has entered something
            const hasContent = currentMood || 
                document.getElementById('water-input').value ||
                document.getElementById('sleep-input').value ||
                document.getElementById('weight-input').value ||
                document.getElementById('notes-input').value ||
                selectedSymptoms.length > 0 ||
                selectedExercise.length > 0;
            
            if (hasContent) {
                const entry = {
                    date: today,
                    mood: currentMood,
                    energy: document.getElementById('energy-slider').value,
                    water: parseInt(document.getElementById('water-input').value) || 0,
                    sleep: parseFloat(document.getElementById('sleep-input').value) || 0,
                    weight: parseFloat(document.getElementById('weight-input').value) || null,
                    symptoms: selectedSymptoms,
                    exercise: selectedExercise,
                    notes: document.getElementById('notes-input').value,
                    timestamp: new Date().toISOString(),
                    autoSaved: true,
                    testMode: isTestMode
                };
                
                savedData[today] = entry;
                localStorage.setItem(storageKey, JSON.stringify(savedData));
            }
        }

        function loadTodaysEntry() {
            const today = new Date().toISOString().split('T')[0];
            const storageKey = getStorageKey('Data');
            const savedData = JSON.parse(localStorage.getItem(storageKey) || '{}');
            const todayEntry = savedData[today];
            
            // Reset state
            selectedSymptoms = [];
            selectedExercise = [];
            currentMood = '';
            
            // Clear UI
            document.querySelectorAll('.mood-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.selection-btn').forEach(btn => btn.classList.remove('selected'));
            
            if (todayEntry) {
                if (todayEntry.mood) selectMood(todayEntry.mood);
                if (todayEntry.energy) document.getElementById('energy-slider').value = todayEntry.energy;
                if (todayEntry.water) document.getElementById('water-input').value = todayEntry.water;
                if (todayEntry.sleep) document.getElementById('sleep-input').value = todayEntry.sleep;
                if (todayEntry.weight) document.getElementById('weight-input').value = todayEntry.weight;
                if (todayEntry.notes) document.getElementById('notes-input').value = todayEntry.notes;
                
                if (todayEntry.symptoms) {
                    selectedSymptoms = [...todayEntry.symptoms];
                    todayEntry.symptoms.forEach(symptom => {
                        const btn = document.getElementById(`symptom-${symptom.replace(/\s+/g, '-').toLowerCase()}`);
                        if (btn) btn.classList.add('selected');
                    });
                }
                
                if (todayEntry.exercise) {
                    selectedExercise = [...todayEntry.exercise];
                    todayEntry.exercise.forEach(exercise => {
                        const btn = document.getElementById(`exercise-${exercise.replace(/\s+/g, '-').toLowerCase()}`);
                        if (btn) btn.classList.add('selected');
                    });
                }
                
                updateSliderValue(document.getElementById('energy-slider'), 'energy-value');
                if (todayEntry.weight) updateBMI();
            } else {
                updateSliderValue(document.getElementById('energy-slider'), 'energy-value');
            }
            
            updateGoals();
        }

        function setupPhotoDragDrop() {
            const uploadArea = document.querySelector('.photo-upload');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), false);
            });
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function handleDrop(e) {
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handlePhotoUpload({ target: { files } });
                }
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const content = document.getElementById('notification-content');
            
            content.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // System Integration Functions
        function loadSystemIntegrations() {
            const integrations = JSON.parse(localStorage.getItem(getStorageKey('Integrations')) || '{}');
            
            Object.keys(integrations).forEach(key => {
                const statusDot = document.getElementById(`${key}-status`);
                const statusLabel = document.getElementById(`${key}-label`);
                
                if (statusDot && statusLabel && integrations[key]) {
                    statusDot.classList.add('connected');
                    statusLabel.textContent = 'Connected';
                }
            });
        }

        function saveIntegrationStatus(integration, status) {
            const storageKey = getStorageKey('Integrations');
            const integrations = JSON.parse(localStorage.getItem(storageKey) || '{}');
            integrations[integration] = status;
            localStorage.setItem(storageKey, JSON.stringify(integrations));
            
            const statusDot = document.getElementById(`${integration}-status`);
            const statusLabel = document.getElementById(`${integration}-label`);
            
            if (statusDot && statusLabel) {
                if (status) {
                    statusDot.classList.add('connected');
                    statusLabel.textContent = 'Connected';
                } else {
                    statusDot.classList.remove('connected');
                    statusLabel.textContent = 'Not connected';
                }
            }
        }

        function shareWithPartner() {
            const partnerEmail = prompt('Enter your partner\'s email address for data sharing:');
            if (partnerEmail && partnerEmail.includes('@')) {
                showNotification('👥 Setting up partner access...', 'success');
                
                setTimeout(() => {
                    saveIntegrationStatus('partner', true);
                    localStorage.setItem(getStorageKey('PartnerEmail'), partnerEmail);
                    
                    // Generate shareable link
                    const shareableLink = `${window.location.origin}${window.location.pathname}?share=${btoa(partnerEmail)}`;
                    
                    // Copy to clipboard
                    navigator.clipboard.writeText(shareableLink).then(() => {
                        showNotification(`👥 Partner access enabled! Share link copied to clipboard.`, 'success');
                    }).catch(() => {
                        showNotification(`👥 Partner access enabled! Share this link: ${shareableLink}`, 'success');
                    });
                }, 1500);
            } else if (partnerEmail) {
                showNotification('Please enter a valid email address.', 'error');
            }
        }

        function setupCloudBackup() {
            if (!googleAuth || !googleAuth.isSignedIn.get()) {
                showNotification('❌ Please connect your Google account first for cloud backup.', 'error');
                return;
            }
            
            showNotification('☁️ Setting up cloud backup...', 'success');
            
            setTimeout(() => {
                saveIntegrationStatus('cloud', true);
                showNotification('☁️ Cloud backup enabled! Data will be automatically backed up to Google Drive.', 'success');
                
                // Trigger initial backup
                syncWithDrive();
            }, 2000);
        }

        function generateQRCode() {
            showNotification('📱 Generating QR code...', 'success');
            
            setTimeout(() => {
                saveIntegrationStatus('qr', true);
                
                // Generate QR code data
                const qrData = {
                    name: 'Elizabeth\'s Pregnancy Tracker',
                    url: window.location.href,
                    mode: isTestMode ? 'test' : 'real',
                    timestamp: new Date().toISOString()
                };
                
                // Create QR code URL (using a free QR service)
                const qrText = encodeURIComponent(JSON.stringify(qrData));
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${qrText}`;
                
                // Open QR code in new window
                window.open(qrCodeUrl, '_blank');
                
                navigator.clipboard.writeText(qrCodeUrl).then(() => {
                    showNotification('📱 QR code generated and URL copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification('📱 QR code generated successfully!', 'success');
                });
            }, 1000);
        }

        // Initialize when page loads
        window.addEventListener('load', init);
        
        // Handle page visibility for notifications
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && remindersEnabled) {
                const storageKey = getStorageKey('LastVisit');
                const lastVisit = localStorage.getItem(storageKey);
                const today = new Date().toISOString().split('T')[0];
                
                if (lastVisit !== today) {
                    setTimeout(() => {
                        const greeting = isTestMode ? 
                            '👋 Welcome back! You\'re in test mode.' : 
                            '👋 Welcome back, Elizabeth! Don\'t forget to log today\'s entry.';
                        showNotification(greeting, 'success');
                    }, 1000);
                }
                
                localStorage.setItem(storageKey, today);
            }
        });

        // Handle URL parameters for sharing
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const shareParam = urlParams.get('share');
            
            if (shareParam) {
                try {
                    const partnerEmail = atob(shareParam);
                    showNotification(`👥 Viewing Elizabeth's pregnancy data shared with ${partnerEmail}`, 'success');
                } catch (e) {
                    console.error('Invalid share parameter');
                }
            }
        });

        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveEntry();
                        break;
                    case 'n':
                        e.preventDefault();
                        saveToNotion();
                        break;
                    case 'e':
                        e.preventDefault();
                        exportData();
                        break;
                }
            }
        });

        // Service Worker for offline functionality (placeholder)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>